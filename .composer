#!/usr/bin/env bash

# Set the timer
START_TIME=$(date +%s)

# Define color variables for output
ESC_SEQ="\x1b["
COL_RED=$ESC_SEQ"31;01m"
COL_CYAN=$ESC_SEQ"36;01m"
COL_GREEN=$ESC_SEQ"32;01m"
COL_YELLOW=$ESC_SEQ"33;01m"
COL_MAGENTA=$ESC_SEQ"35;01m"
COL_RESET=$ESC_SEQ"39;49;00m"

echo "----------------------------------------------"
echo -e $COL_YELLOW"Installing Composer and Laravel Valet..."$COL_RESET
echo "----------------------------------------------"

echo -e "Installing Composer..."
php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"

echo -e "Verifying the installer..."
php -r "if (hash_file('SHA384', 'composer-setup.php') === '544e09ee996cdf60ece3804abc52599c22b1f40f4323403c44d44fdfdd586475ca9813a858088ffbc1f233e9b180f061') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;"

echo -e "Running the setup script..."
php composer-setup.php

echo -e "Cleaning up..."
php -r "unlink('composer-setup.php');"

echo -e "Allowing global access to the Composer executable..."
mv composer.phar /usr/local/bin/composer

echo -e "Installing Laravel Valet..."
composer global require laravel/valet
valet install

# Stop the timer
END_TIME=$(date +%s)

echo "------------------------------------------------"
echo -e $COL_GREEN"âœ” Finished.$COL_RESET (`expr $END_TIME - $START_TIME`s)"
echo "------------------------------------------------"
